<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoilFarmingAgent - Smart Agriculture Solution</title>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            position: relative;
            overflow-x: hidden;
        }

        /* Animated Background */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .floating-element {
            position: absolute;
            opacity: 0.1;
            animation: float 15s infinite linear;
        }

        .floating-element:nth-child(1) {
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .floating-element:nth-child(2) {
            top: 60%;
            left: 80%;
            animation-delay: -5s;
        }

        .floating-element:nth-child(3) {
            top: 80%;
            left: 20%;
            animation-delay: -10s;
        }

        @keyframes float {
            0% {
                transform: translateY(0px) rotate(0deg);
                opacity: 0.1;
            }
            50% {
                opacity: 0.3;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0.1;
            }
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            animation: slideDown 0.8s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 100px 2rem 2rem;
        }

        /* Page Sections */
        .page {
            display: none;
            animation: fadeInUp 0.6s ease-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Home Page */
        .hero {
            text-align: center;
            padding: 4rem 0;
            color: white;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                text-shadow: 3px 3px 6px rgba(0,0,0,0.3), 0 0 20px rgba(255,255,255,0.2);
            }
            to {
                text-shadow: 3px 3px 6px rgba(0,0,0,0.3), 0 0 30px rgba(255,255,255,0.4);
            }
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 4rem;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            animation: slideInUp 0.6s ease-out;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }

        /* Forms */
        .form-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 3rem;
            margin: 2rem auto;
            max-width: 500px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: scaleIn 0.5s ease-out;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: white;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .form-control:focus {
            outline: none;
            border-color: #4facfe;
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.3);
        }

        /* Data Display */
        .data-container {
            display: grid;
            gap: 2rem;
            margin-top: 2rem;
        }

        .data-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .data-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .data-card h3 {
            color: #4facfe;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .data-card p {
            color: white;
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }

        /* Loading Animation */
        .loading {
            display: none;
            text-align: center;
            color: white;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Alert Messages */
        .alert {
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            font-weight: 600;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .alert-success {
            background: rgba(67, 233, 123, 0.2);
            border: 1px solid #43e97b;
            color: #43e97b;
        }

        .alert-error {
            background: rgba(247, 112, 154, 0.2);
            border: 1px solid #fa709a;
            color: #fa709a;
        }

        /* User Status */
        .user-status {
            color: white;
            margin-right: 1rem;
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .nav-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .container {
                padding: 140px 1rem 2rem;
            }
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="floating-element">🌱</div>
        <div class="floating-element">🚜</div>
        <div class="floating-element">🌾</div>
    </div>

    <!-- Header -->
    <header class="header">
        <nav class="nav-container">
            <div class="logo">🌾 SoilFarmingAgent</div>
            <div class="nav-buttons">
                <span id="userStatus" class="user-status hidden"></span>
                <button class="btn btn-primary" onclick="showPage('home')" id="homeBtn">Home</button>
                <button class="btn btn-secondary" onclick="showPage('login')" id="loginBtn">Login</button>
                <button class="btn btn-secondary" onclick="showPage('register')" id="registerBtn">Register</button>
                <button class="btn btn-primary" onclick="showPage('adminDashboard')" id="adminBtn" style="display: none;">Admin</button>
                <button class="btn btn-primary" onclick="showPage('userDashboard')" id="userBtn" style="display: none;">Dashboard</button>
                <button class="btn btn-danger" onclick="logout()" id="logoutBtn" style="display: none;">Logout</button>
            </div>
        </nav>
    </header>

    <div class="container">
        <!-- Home Page -->
        <div id="home" class="page active">
            <div class="hero">
                <h1>SoilFarmingAgent</h1>
                <p>Your Smart Agriculture Companion - Discover the perfect soil for your crops</p>
                <button class="btn btn-primary" onclick="showPage('register')">Get Started</button>
            </div>
            
            <div class="features">
                <div class="feature-card">
                    <span class="feature-icon">🔬</span>
                    <h3>Soil Analysis</h3>
                    <p>Comprehensive soil type information including pH levels, nutrients, and crop compatibility</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">🌱</span>
                    <h3>Crop Recommendations</h3>
                    <p>Get personalized crop suggestions based on your soil type and local conditions</p>
                </div>
                <div class="feature-card">
                    <span class="feature-icon">🚚</span>
                    <h3>Distributor Network</h3>
                    <p>Connect with verified seed and crop distributors in your area</p>
                </div>
            </div>
        </div>

        <!-- Login Page -->
        <div id="login" class="page">
            <div class="form-container">
                <h2 style="text-align: center; color: white; margin-bottom: 2rem;">Login</h2>
                <div id="loginAlert"></div>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" class="form-control" required placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" class="form-control" required placeholder="Enter your password">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="isAdmin" style="margin-right: 0.5rem;">
                            Login as Admin
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                </form>
            </div>
        </div>

        <!-- Register Page -->
        <div id="register" class="page">
            <div class="form-container">
                <h2 style="text-align: center; color: white; margin-bottom: 2rem;">Register</h2>
                <div id="registerAlert"></div>
                <form id="registerForm">
                    <div class="form-group">
                        <label for="registerName">Full Name</label>
                        <input type="text" id="registerName" class="form-control" required placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" class="form-control" required placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" class="form-control" required placeholder="Create a password" minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="registerLocation">Location</label>
                        <input type="text" id="registerLocation" class="form-control" required placeholder="Enter your location">
                    </div>
                    <button type="submit" class="btn btn-secondary" style="width: 100%;">Register</button>
                </form>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="page">
            <h2 style="color: white; text-align: center; margin-bottom: 2rem;">Admin Dashboard</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 3rem;">
                <!-- Add Soil Details -->
                <div class="form-container" style="margin: 0;">
                    <h3 style="color: white; margin-bottom: 1.5rem;">Add Soil Details</h3>
                    <div id="soilAlert"></div>
                    <form id="soilForm">
                        <div class="form-group">
                            <label for="soilType">Soil Type</label>
                            <input type="text" id="soilType" class="form-control" required placeholder="e.g., Clay, Sandy, Loam">
                        </div>
                        <div class="form-group">
                            <label for="soilPH">pH Level</label>
                            <input type="number" id="soilPH" class="form-control" step="0.1" min="0" max="14" required placeholder="e.g., 6.5">
                        </div>
                        <div class="form-group">
                            <label for="soilNutrients">Nutrients</label>
                            <input type="text" id="soilNutrients" class="form-control" required placeholder="e.g., High in Nitrogen, Phosphorus">
                        </div>
                        <div class="form-group">
                            <label for="suitableCrops">Suitable Crops</label>
                            <input type="text" id="suitableCrops" class="form-control" required placeholder="e.g., Rice, Wheat, Corn">
                        </div>
                        <div class="form-group">
                            <label for="soilCharacteristics">Characteristics</label>
                            <textarea id="soilCharacteristics" class="form-control" rows="3" required placeholder="Describe soil characteristics..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Add Soil Details</button>
                    </form>
                </div>

                <!-- Add Distributor Details -->
                <div class="form-container" style="margin: 0;">
                    <h3 style="color: white; margin-bottom: 1.5rem;">Add Distributor Details</h3>
                    <div id="distributorAlert"></div>
                    <form id="distributorForm">
                        <div class="form-group">
                            <label for="distributorName">Distributor Name</label>
                            <input type="text" id="distributorName" class="form-control" required placeholder="Enter distributor name">
                        </div>
                        <div class="form-group">
                            <label for="distributorLocation">Location</label>
                            <input type="text" id="distributorLocation" class="form-control" required placeholder="Enter location">
                        </div>
                        <div class="form-group">
                            <label for="distributorContact">Contact</label>
                            <input type="text" id="distributorContact" class="form-control" required placeholder="Phone/Email">
                        </div>
                        <div class="form-group">
                            <label for="distributorProducts">Products/Seeds</label>
                            <input type="text" id="distributorProducts" class="form-control" required placeholder="e.g., Rice seeds, Fertilizers">
                        </div>
                        <div class="form-group">
                            <label for="distributorDescription">Description</label>
                            <textarea id="distributorDescription" class="form-control" rows="3" required placeholder="Describe distributor services..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-secondary" style="width: 100%;">Add Distributor</button>
                    </form>
                </div>
            </div>

            <!-- View All Data -->
            <div style="text-align: center; margin-bottom: 2rem;">
                <button class="btn btn-primary" onclick="loadAdminData()">Refresh Data</button>
            </div>
            
            <div class="loading" id="adminLoading">
                <div class="spinner"></div>
                <p>Loading data...</p>
            </div>
            
            <div id="adminData" class="data-container"></div>
        </div>

        <!-- User Dashboard -->
        <div id="userDashboard" class="page">
            <h2 style="color: white; text-align: center; margin-bottom: 2rem;">User Dashboard</h2>
            
            <div style="text-align: center; margin-bottom: 2rem;">
                <button class="btn btn-primary" onclick="loadUserData()">View Soil Details</button>
                <button class="btn btn-secondary" onclick="loadDistributorData()" style="margin-left: 1rem;">View Distributors</button>
            </div>
            
            <div class="loading" id="userLoading">
                <div class="spinner"></div>
                <p>Loading data...</p>
            </div>
            
            <div id="userData" class="data-container"></div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        
        const firebaseConfig = {
             apiKey: "AIzaSyD7OdAsGvXzfMjnzjW6v8M_qu22QysV47I",
             authDomain: "soil-farming-agent-6291c.firebaseapp.com",
             projectId: "soil-farming-agent-6291c",
             storageBucket: "soil-farming-agent-6291c.firebasestorage.app",
             messagingSenderId: "306378828955",
             appId: "1:306378828955:web:14737657113e9a6f6c6a3e",
             measurementId: "G-JJ1MR41E1G"
            };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Logger Class
        class Logger {
            static log(level, message, data = null) {
                const timestamp = new Date().toISOString();
                const logEntry = {
                    timestamp,
                    level,
                    message,
                    data
                };
                
                console.log(`[${timestamp}] [${level.toUpperCase()}] ${message}`, data || '');
                
                // Store in Firebase (optional)
                if (firebase.apps.length > 0) {
                    db.collection('logs').add(logEntry).catch(console.error);
                }
            }

            static info(message, data) {
                this.log('info', message, data);
            }

            static warn(message, data) {
                this.log('warn', message, data);
            }

            static error(message, data) {
                this.log('error', message, data);
            }
        }

        // Global Variables
        let currentUser = null;
        let isAdminUser = false;

        // Page Navigation
        function showPage(pageId) {
            Logger.info(`Navigating to page: ${pageId}`);
            
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Clear alerts
            clearAlerts();
        }

        // Authentication State Observer
        auth.onAuthStateChanged(user => {
            currentUser = user;
            Logger.info('Auth state changed', { user: user ? user.email : 'null' });
            
            if (user) {
                // User is logged in
                document.getElementById('userStatus').textContent = `Welcome, ${user.displayName || user.email}`;
                document.getElementById('userStatus').classList.remove('hidden');
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('registerBtn').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'inline-block';
                
                // Check if admin
                checkAdminStatus(user);
            } else {
                // User is logged out
                document.getElementById('userStatus').classList.add('hidden');
                document.getElementById('loginBtn').style.display = 'inline-block';
                document.getElementById('registerBtn').style.display = 'inline-block';
                document.getElementById('logoutBtn').style.display = 'none';
                document.getElementById('adminBtn').style.display = 'none';
                document.getElementById('userBtn').style.display = 'none';
                isAdminUser = false;
                showPage('home');
            }
        });

        // Check Admin Status
        async function checkAdminStatus(user) {
            try {
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    isAdminUser = userData.isAdmin === true;
                    
                    if (isAdminUser) {
                        document.getElementById('adminBtn').style.display = 'inline-block';
                        document.getElementById('userBtn').style.display = 'none';
                        Logger.info('User logged in as admin');
                    } else {
                        document.getElementById('adminBtn').style.display = 'none';
                        document.getElementById('userBtn').style.display = 'inline-block';
                        Logger.info('User logged in as regular user');
                    }
                }
            } catch (error) {
                Logger.error('Error checking admin status', error);
            }
        }

        // Register Function
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            Logger.info('Registration attempt started');
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const location = document.getElementById('registerLocation').value;
            
            try {
                showAlert('registerAlert', 'Creating account...', 'info');
                
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Update profile
                await user.updateProfile({ displayName: name });
                
                // Save user data
                await db.collection('users').doc(user.uid).set({
                    name: name,
                    email: email,
                    location: location,
                    isAdmin: false,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                Logger.info('User registered successfully', { email });
                showAlert('registerAlert', 'Registration successful!', 'success');
                
                setTimeout(() => {
                    showPage('userDashboard');
                }, 1500);
                
            } catch (error) {
                Logger.error('Registration error', error);
                showAlert('registerAlert', error.message, 'error');
            }
        });

        // Login Function
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            Logger.info('Login attempt started');
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const adminLogin = document.getElementById('isAdmin').checked;
            
            try {
                showAlert('loginAlert', 'Signing in...', 'info');
                
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Check admin status if admin login
                if (adminLogin) {
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    if (userDoc.exists && userDoc.data().isAdmin === true) {
                        Logger.info('Admin login successful', { email });
                        showAlert('loginAlert', 'Admin login successful!', 'success');
                        setTimeout(() => showPage('adminDashboard'), 1500);
                    } else {
                        await auth.signOut();
                        throw new Error('Admin access denied');
                    }
                } else {
                    Logger.info('User login successful', { email });
                    showAlert('loginAlert', 'Login successful!', 'success');
                    setTimeout(() => showPage('userDashboard'), 1500);
                }
                
            } catch (error) {
                Logger.error('Login error', error);
                showAlert('loginAlert', error.message, 'error');
            }
        });

        // Logout Function
        async function logout() {
            try {
                await auth.signOut();
                Logger.info('User logged out');
                showPage('home');
            } catch (error) {
                Logger.error('Logout error', error);
            }
        }

        // Add Soil Details
        document.getElementById('soilForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            Logger.info('Adding soil details');
            
            const soilData = {
                type: document.getElementById('soilType').value,
                ph: parseFloat(document.getElementById('soilPH').value),
                nutrients: document.getElementById('soilNutrients').value,
                suitableCrops: document.getElementById('suitableCrops').value.split(',').map(crop => crop.trim()),
                characteristics: document.getElementById('soilCharacteristics').value,
                addedBy: currentUser.uid,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                showAlert('soilAlert', 'Adding soil details...', 'info');
                
                await db.collection('soils').add(soilData);
                
                Logger.info('Soil details added successfully', soilData);
                showAlert('soilAlert', 'Soil details added successfully!', 'success');
                
                document.getElementById('soilForm').reset();
                loadAdminData();
                
            } catch (error) {
                Logger.error('Error adding soil details', error);
                showAlert('soilAlert', 'Error adding soil details: ' + error.message, 'error');
            }
        });

        // Add Distributor Details
        document.getElementById('distributorForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            Logger.info('Adding distributor details');
            
            const distributorData = {
                name: document.getElementById('distributorName').value,
                location: document.getElementById('distributorLocation').value,
                contact: document.getElementById('distributorContact').value,
                products: document.getElementById('distributorProducts').value.split(',').map(product => product.trim()),
                description: document.getElementById('distributorDescription').value,
                addedBy: currentUser.uid,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                showAlert('distributorAlert', 'Adding distributor details...', 'info');
                
                await db.collection('distributors').add(distributorData);
                
                Logger.info('Distributor details added successfully', distributorData);
                showAlert('distributorAlert', 'Distributor details added successfully!', 'success');
                
                document.getElementById('distributorForm').reset();
                loadAdminData();
                
            } catch (error) {
                Logger.error('Error adding distributor details', error);
                showAlert('distributorAlert', 'Error adding distributor details: ' + error.message, 'error');
            }
        });

        // Load Admin Data
        async function loadAdminData() {
            Logger.info('Loading admin data');
            
            const loading = document.getElementById('adminLoading');
            const dataContainer = document.getElementById('adminData');
            
            loading.style.display = 'block';
            dataContainer.innerHTML = '';
            
            try {
                // Load soil data
                const soilSnapshot = await db.collection('soils').orderBy('createdAt', 'desc').get();
                const distributorSnapshot = await db.collection('distributors').orderBy('createdAt', 'desc').get();
                
                let html = '<h3 style="color: white; margin-bottom: 1rem;">📊 Soil Database</h3>';
                
                if (!soilSnapshot.empty) {
                    soilSnapshot.forEach(doc => {
                        const soil = doc.data();
                        html += `
                            <div class="data-card">
                                <h3>🌱 ${soil.type} Soil</h3>
                                <p><strong>pH Level:</strong> ${soil.ph}</p>
                                <p><strong>Nutrients:</strong> ${soil.nutrients}</p>
                                <p><strong>Suitable Crops:</strong> ${Array.isArray(soil.suitableCrops) ? soil.suitableCrops.join(', ') : soil.suitableCrops}</p>
                                <p><strong>Characteristics:</strong> ${soil.characteristics}</p>
                                <button class="btn btn-danger" onclick="deleteData('soils', '${doc.id}')" style="margin-top: 1rem;">Delete</button>
                            </div>
                        `;
                    });
                } else {
                    html += '<div class="data-card"><p>No soil data available</p></div>';
                }
                
                html += '<h3 style="color: white; margin: 2rem 0 1rem;">🚚 Distributor Database</h3>';
                
                if (!distributorSnapshot.empty) {
                    distributorSnapshot.forEach(doc => {
                        const distributor = doc.data();
                        html += `
                            <div class="data-card">
                                <h3>🏪 ${distributor.name}</h3>
                                <p><strong>Location:</strong> ${distributor.location}</p>
                                <p><strong>Contact:</strong> ${distributor.contact}</p>
                                <p><strong>Products:</strong> ${Array.isArray(distributor.products) ? distributor.products.join(', ') : distributor.products}</p>
                                <p><strong>Description:</strong> ${distributor.description}</p>
                                <button class="btn btn-danger" onclick="deleteData('distributors', '${doc.id}')" style="margin-top: 1rem;">Delete</button>
                            </div>
                        `;
                    });
                } else {
                    html += '<div class="data-card"><p>No distributor data available</p></div>';
                }
                
                dataContainer.innerHTML = html;
                Logger.info('Admin data loaded successfully');
                
            } catch (error) {
                Logger.error('Error loading admin data', error);
                dataContainer.innerHTML = '<div class="alert alert-error">Error loading data: ' + error.message + '</div>';
            } finally {
                loading.style.display = 'none';
            }
        }

        // Load User Data (Soil Details)
        async function loadUserData() {
            Logger.info('Loading soil data for user');
            
            const loading = document.getElementById('userLoading');
            const dataContainer = document.getElementById('userData');
            
            loading.style.display = 'block';
            dataContainer.innerHTML = '';
            
            try {
                const snapshot = await db.collection('soils').orderBy('createdAt', 'desc').get();
                
                let html = '<h3 style="color: white; margin-bottom: 1rem;">🌱 Available Soil Types</h3>';
                
                if (!snapshot.empty) {
                    snapshot.forEach(doc => {
                        const soil = doc.data();
                        html += `
                            <div class="data-card">
                                <h3>🌱 ${soil.type} Soil</h3>
                                <p><strong>pH Level:</strong> ${soil.ph} ${getPhDescription(soil.ph)}</p>
                                <p><strong>Nutrients:</strong> ${soil.nutrients}</p>
                                <p><strong>Best Crops:</strong> ${Array.isArray(soil.suitableCrops) ? soil.suitableCrops.join(', ') : soil.suitableCrops}</p>
                                <p><strong>Characteristics:</strong> ${soil.characteristics}</p>
                                <div style="margin-top: 1rem;">
                                    <span style="background: rgba(79, 172, 254, 0.2); color: #4facfe; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem;">
                                        ${getCropRecommendation(soil.type)}
                                    </span>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html += '<div class="data-card"><p>No soil data available. Please contact admin to add soil information.</p></div>';
                }
                
                dataContainer.innerHTML = html;
                Logger.info('User data loaded successfully');
                
            } catch (error) {
                Logger.error('Error loading user data', error);
                dataContainer.innerHTML = '<div class="alert alert-error">Error loading data: ' + error.message + '</div>';
            } finally {
                loading.style.display = 'none';
            }
        }

        // Load Distributor Data
        async function loadDistributorData() {
            Logger.info('Loading distributor data for user');
            
            const loading = document.getElementById('userLoading');
            const dataContainer = document.getElementById('userData');
            
            loading.style.display = 'block';
            dataContainer.innerHTML = '';
            
            try {
                const snapshot = await db.collection('distributors').orderBy('createdAt', 'desc').get();
                
                let html = '<h3 style="color: white; margin-bottom: 1rem;">🚚 Verified Distributors</h3>';
                
                if (!snapshot.empty) {
                    snapshot.forEach(doc => {
                        const distributor = doc.data();
                        html += `
                            <div class="data-card">
                                <h3>🏪 ${distributor.name}</h3>
                                <p><strong>📍 Location:</strong> ${distributor.location}</p>
                                <p><strong>📞 Contact:</strong> ${distributor.contact}</p>
                                <p><strong>🌾 Products:</strong> ${Array.isArray(distributor.products) ? distributor.products.join(', ') : distributor.products}</p>
                                <p><strong>📝 About:</strong> ${distributor.description}</p>
                                <div style="margin-top: 1rem;">
                                    <span style="background: rgba(67, 233, 123, 0.2); color: #43e97b; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem;">
                                        ✅ Verified Distributor
                                    </span>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html += '<div class="data-card"><p>No distributors available. Please contact admin to add distributor information.</p></div>';
                }
                
                dataContainer.innerHTML = html;
                Logger.info('Distributor data loaded successfully');
                
            } catch (error) {
                Logger.error('Error loading distributor data', error);
                dataContainer.innerHTML = '<div class="alert alert-error">Error loading data: ' + error.message + '</div>';
            } finally {
                loading.style.display = 'none';
            }
        }

        // Delete Data Function
        async function deleteData(collection, docId) {
            if (confirm('Are you sure you want to delete this item?')) {
                try {
                    await db.collection(collection).doc(docId).delete();
                    Logger.info(`Deleted ${collection} document`, { docId });
                    loadAdminData();
                } catch (error) {
                    Logger.error(`Error deleting ${collection} document`, error);
                    alert('Error deleting item: ' + error.message);
                }
            }
        }

        // Helper Functions
        function getPhDescription(ph) {
            if (ph < 6.0) return '(Acidic)';
            if (ph > 7.5) return '(Alkaline)';
            return '(Neutral)';
        }

        function getCropRecommendation(soilType) {
            const recommendations = {
                'Clay': 'Best for rice, wheat, and vegetables',
                'Sandy': 'Ideal for root vegetables and melons',
                'Loam': 'Perfect for most crops - universal soil',
                'Silt': 'Great for corn and soybeans',
                'Peat': 'Excellent for organic farming'
            };
            
            return recommendations[soilType] || 'Contact local agriculture expert for recommendations';
        }

        // Alert Functions
        function showAlert(containerId, message, type) {
            const container = document.getElementById(containerId);
            const alertClass = type === 'success' ? 'alert-success' : 
                              type === 'error' ? 'alert-error' : 
                              'alert-success';
            
            container.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
            
            if (type === 'success') {
                setTimeout(() => {
                    container.innerHTML = '';
                }, 3000);
            }
        }

        function clearAlerts() {
            const alerts = ['loginAlert', 'registerAlert', 'soilAlert', 'distributorAlert'];
            alerts.forEach(alertId => {
                document.getElementById(alertId).innerHTML = '';
            });
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            Logger.info('SoilFarmingAgent application initialized');
            
            // Add sample admin user (for testing)
            // This should be done manually in production
            if (firebase.apps.length > 0) {
                // Check if we need to create admin user
                setTimeout(async () => {
                    try {
                        const adminCheck = await db.collection('users').where('isAdmin', '==', true).limit(1).get();
                        if (adminCheck.empty) {
                            Logger.info('No admin user found. Please register an admin user manually.');
                        }
                    } catch (error) {
                        Logger.warn('Could not check for admin user', error);
                    }
                }, 2000);
            }
        });

        // Performance optimization - Lazy loading
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '50px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        // Observe all cards for animation
        setTimeout(() => {
            document.querySelectorAll('.data-card, .feature-card').forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'all 0.6s ease';
                observer.observe(card);
            });
        }, 100);

        // Service Worker for offline support (basic)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        Logger.info('SW registered', registration);
                    })
                    .catch(registrationError => {
                        Logger.warn('SW registration failed', registrationError);
                    });
            });
        }
    </script>

    <!-- Simple Service Worker for offline support -->
    <script>
        // Create inline service worker
        const swCode = `
            const CACHE_NAME = 'soil-farming-agent-v1';
            const urlsToCache = [
                '/',
                '/index.html'
            ];

            self.addEventListener('install', event => {
                event.waitUntil(
                    caches.open(CACHE_NAME)
                        .then(cache => cache.addAll(urlsToCache))
                );
            });

            self.addEventListener('fetch', event => {
                event.respondWith(
                    caches.match(event.request)
                        .then(response => {
                            return response || fetch(event.request);
                        }
                    )
                );
            });
        `;

        // Register service worker
        if ('serviceWorker' in navigator) {
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
                .then(() => Logger.info('Service Worker registered successfully'))
                .catch(error => Logger.warn('Service Worker registration failed:', error));
        }
    </script>
</body>
</html>